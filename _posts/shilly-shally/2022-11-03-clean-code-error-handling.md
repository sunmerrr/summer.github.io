---
title: "오류 처리"
excerpt: "clean code study #4-1"

categories:
  - Developer
tags:
  - [Software, web, Developer, Software Developer, Clean Code]

toc: true
toc_sticky: true
 
date: 2022-11-03
last_modified_at: 2022-11-06
---


## 오류 처리
- ###### 깨끗한 코드는 읽기도 좋아야 하지만 안정성도 높아야 한다.
- ###### 오류 처리를 프로그램 논리와 분리하면 독립적인 추론이 가능해지며 코드 유지보수성도 크게 높아진다.

#### 1. 예외 사용
  - 오류가 발생하면 예외를 던지는 편이 남
  - 오류를 처리하는 알고리즘을 분리하면 코드 품질을 높이며, 각 개념을 독립적으로 살펴보고 이해할 수 있게 됨

#### 2. Try-Catch-Fially
  - try 블록에서 무슨 일이 생기든 catch 블록은 프로그램 상태를 일관성있게 유지해야 함
  - try-catch 구조로 범위를 정한 후 TDD를 사용
    - 강제로 예외를 일으키는 테스트 케이스를 작성 -> 테스트를 통과하도록 코드 작성
    - 자연스럽게 try 블록의 트랜잭션 범위부터 구현하게 되므로 범위 내에서 트랜잭션 본질을 유지하기가 쉬워짐

#### 3. 미확인(uncheched) 예외
  - 확인된 예외의 단점
    > 대규모 시스템에서 호출이 일어나는 방식을 상상해보라. 최상위 함수가 아래 함수를 호출한다. 아래 함수는 그 아래 함수를 호출한다. 단계를 내려갈수록 호출하는 함수 수는 늘어난다. 이제 최하위 함수를 변경해 새로운 오류를 던진다고 가정하자. 확인된 오류를 던진다면 함수는 선언부에 throws 절을 추가해야 한다. 그러면 변경한 함수를 호출하는 함수 모두가 1) catch 블록에서 새로운 예외를 처리하거나 2) 선언부에 throw 절을 추가해야 한다는 말이다. 결과적으로 최하위 단계에서 최상위 단계까지 연괘적인 수정이 일어난다! throws 경로에 위차하는 모든 함수가 최하위 함수에서 던지는 예외를 알아야 하므로 캡슐화가 깨진다. 오류를 원거리에서 처리하기 위해 예외를 사용한다는 사실을 감안한다면 이처럼 확인된 예외가 캡슐화를 깨버리는 현상을 참으로 유감스럽다.

#### 4. 의미 제공
  - 예외를 던질 때는 전후 상황을 충분히 덧붙임 -> `오류가 발생한 원인과 위치를 찾기가 쉬워짐`
  - 오류 메시지에 정보를 담아 예외와 함께 던짐 + 실패한 연산 이름과 실패 유형도 언급

#### 5. 호출자 고려
  - `오류를 잡아내는 방법`: 애플리케이션에서 오류를 정의할 때 프로그래머에게 가장 중요한 관심사
  - 오류를 분류하는 방법
    - 위치로 분류: 오류가 발생한 컴포넌트로 분류
    - 유형으로 분류: 디바이스 실패, 네트워크 실패, 프로그래밍 오류 등
  - Wrapper class
    ```java
    // 예외를 잡아 변환해주는 class
    LocalPort port = new LocalPort(12);
    try {
      port.open();
    } catch (PortDeviceFailure e) {
      reportError(e);
      logger.log(e.getMessage(), e);
    } finally {
      ...
    }
    ```
    - 외부 API를 사용할 때는 감싸기 기법이 최선임
    - 의존성이 크게 줄어듬
    - 추후에 다른 라이브러리로 갈아타도 비용이 크지 않음
    - 테스트하기도 쉬움
    - 특정 업체가 API를 설계한 방식에 발목잡히지 않음 
    
#### 6. 특수 사례 패턴(Special Case Pattern)
  - 클래스를 만들거나 객체를 조작해 특수 사례를 처리하는 방식

#### 7. null 반환과 전달
  - null 반환 금지
    - null 을 반환하게되면 호출자에게 문제를 떠넘김
    - 메서드에서 null을 반환하고 싶은 유혹이 든다면 그 대신 예외를 던지거나 특수 사례 객체를 반환 
    - 사용하려는 외부 API가 null을 반환한다면 감싸기 메서드를 구현해 예외를 던지거나 특수 사례 객체를 반환하는 방식을 고려
  - null 전달 금지
    - 대다수 프로그래밍 언어는 호출자가 실수로 넘기는 null을 적절히 처리하는 방법이 없음ㅜ
